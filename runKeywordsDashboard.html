<!-- This file includes embedded JS/CSS due to project type rules -->
<html>
<head>
  <base target="_top">
  <style>
    #scraperForm { margin: 16px; }
    #scraperForm label { display: block; margin-bottom: 8px; font-weight: 600; }
    #scraperForm input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; margin-bottom: 12px; }
    #scraperForm button { padding: 8px 16px; font-size: 14px; cursor: pointer; }
    #progressPanel { margin: 16px; padding: 12px; border: 1px solid #ccc; background: #f9f9f9; min-height: 40px; }
    #progressPanel .error { color: #c00; }
    #progressPanel pre { white-space: pre-wrap; word-wrap: break-word; margin-top: 8px; }
  </style>
</head>
<body>
  <div id="sidebar" role="complementary" aria-label="SEO Snapshot sidebar">
    <form id="scraperForm">
      <label for="keyword">Target keyword:</label>
      <input id="keyword" name="keyword" type="text" placeholder="Enter keyword or phrase" />
      <button id="runBtn" type="submit">Run Scraper</button>
    </form>
    <div id="progressPanel" role="status" aria-live="polite"></div>
  </div>
  <script>
    (function(){
      var form = document.getElementById('scraperForm');
      var input = document.getElementById('keyword');
      var button = document.getElementById('runBtn');
      var panel = document.getElementById('progressPanel');

      form.addEventListener('submit', function(e){
        e.preventDefault();
        clearPanel();
        var kw = input.value.trim();
        if (!kw) {
          showError('Please enter a keyword.');
          return;
        }
        disableForm();
        showStatus('Starting scraper for "' + kw + '"...');
        google.script.run
          .withSuccessHandler(function(res){
            showSuccess(res);
            enableForm();
          })
          .withFailureHandler(function(err){
            var msg = err && err.message ? err.message : err;
            showError(msg);
            enableForm();
          })
          .runScraper(kw);
      });

      function showStatus(msg){
        panel.textContent = msg;
      }

      function showSuccess(res){
        showStatus('Scraper completed successfully.');
        if (res && res.log) {
          var pre = document.createElement('pre');
          pre.textContent = res.log;
          panel.appendChild(pre);
        }
      }

      function showError(msg){
        panel.textContent = '';
        var div = document.createElement('div');
        div.className = 'error';
        div.textContent = 'Error: ' + msg;
        panel.appendChild(div);
        input.focus();
      }

      function clearPanel(){
        panel.textContent = '';
      }

      function disableForm(){
        input.disabled = true;
        button.disabled = true;
      }

      function enableForm(){
        input.disabled = false;
        button.disabled = false;
      }
    })();
  </script>
</body>
</html>